# MediaAITools 开发指南

## 环境搭建

### 1. Python环境

推荐使用Python 3.10或更高版本：

```bash
python --version  # 检查版本
```

### 2. 安装依赖

```bash
cd code
pip install -r requirements.txt
```

### 3. 安装FFmpeg

#### Windows
1. 下载FFmpeg: https://ffmpeg.org/download.html
2. 解压并添加到系统PATH
3. 验证安装: `ffmpeg -version`

#### macOS
```bash
brew install ffmpeg
```

#### Linux
```bash
sudo apt-get install ffmpeg  # Ubuntu/Debian
sudo yum install ffmpeg      # CentOS/RHEL
```

### 4. 配置

1. 复制配置文件：
```bash
cp config/config.example.yaml config/config.yaml
```

2. 编辑 `config/config.yaml`，设置LLM API密钥等参数

## 项目结构说明

```
code/
├── mcp_server/      # MCP服务器实现
│   ├── media_mcp_server.py  # MCP服务器主类
│   └── tools.py            # 音视频处理工具
├── agent/           # Agent框架
│   ├── base_agent.py       # Agent基类
│   └── media_agent.py      # 主Media Agent
├── skills/          # Agent Skills
│   ├── base_skill.py       # Skill基类
│   ├── clip_skill.py       # 剪辑Skill
│   ├── subtitle_skill.py   # 字幕Skill
│   └── ...
├── llm/             # LLM集成
│   ├── providers.py        # LLM提供商实现
│   └── llm_manager.py      # LLM管理器
├── utils/           # 工具函数
│   ├── logger.py           # 日志工具
│   └── media_utils.py      # 媒体文件工具
└── config/          # 配置管理
    └── __init__.py         # 配置加载
```

## 核心概念

### MCP (Model Context Protocol)

MCP提供标准化的工具调用接口。所有音视频处理操作都通过MCP工具进行。

### Agent

Agent负责理解用户意图，规划任务执行。MediaAgent是主Agent，协调各个专项Agent和Skills。

### Agent Skills

Skills封装具体的处理能力，如ClipSkill处理剪辑任务，SubtitleSkill处理字幕任务。

## 添加新功能

### 1. 添加新的MCP工具

在 `mcp_server/tools.py` 中创建新的工具类：

```python
class NewTool(MediaTool):
    def execute(self, **kwargs) -> Dict[str, Any]:
        # 实现工具逻辑
        pass
```

在 `mcp_server/media_mcp_server.py` 中注册工具。

### 2. 添加新的Agent Skill

在 `skills/` 目录下创建新的Skill类：

```python
class NewSkill(BaseSkill):
    def __init__(self):
        super().__init__("NewSkill", "Description")
    
    async def execute(self, instruction: str, context=None):
        # 实现Skill逻辑
        pass
```

在 `skills/skill_registry.py` 中注册Skill。

### 3. 集成新的LLM提供商

在 `llm/providers.py` 中实现新的Provider类，继承 `BaseLLMProvider`。

## 运行项目

### 命令行模式

```bash
python main.py
```

### 作为模块导入

```python
from agent import MediaAgent

agent = MediaAgent()
result = await agent.process("剪辑视频 video.mp4 从 00:01:20 到 00:02:30")
```

## 调试

1. 设置日志级别为DEBUG：
   ```yaml
   logging:
     level: "DEBUG"
   ```

2. 查看日志文件：`logs/mediaai.log`

3. 使用pdb调试：
   ```python
   import pdb; pdb.set_trace()
   ```

## 常见问题

### FFmpeg未找到

确保FFmpeg已安装并在PATH中，或在配置文件中指定完整路径：
```yaml
media:
  ffmpeg_path: "C:/path/to/ffmpeg.exe"
```

### LLM API调用失败

检查：
1. API密钥是否正确配置
2. 网络连接是否正常
3. API配额是否充足

### 视频处理失败

检查：
1. 输入文件是否存在且格式正确
2. 输出目录是否有写入权限
3. FFmpeg命令是否正确

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 编写测试用例
4. 提交Pull Request

## 许可证

MIT License
